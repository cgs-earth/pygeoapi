<script id="gui-block" type="text/x-template">
  <div class="gui-block">

    <template v-if="renderable">
      <span class="mx-2" v-text="vals"></span>
    </template>

    <template v-else>
      <v-hover v-slot:default="{ hover }">
        <v-card width="100%" height="100%">

          <v-card-text>
            <table class="table table-striped mb-0">
              <tbody>
                <tr v-for="(v, k) in vals" :key="k">
                  <td>
                    <h4
                      v-if="typeof k === 'string'"
                      class="mx-1"
                      v-html="$root.capitalize(k,1)"
                    ></h4>
                    <v-responsive width="100%">
                      <gui-block
                        :key="`${id}.${k}`"
                        :label="k"
                        :vals="v"
                        :depth="depth_ + 1"
                      />
                    </v-responsive>
                  </td>
                </tr>
              </tbody>
            </table>
          </v-card-text>

          <v-card-actions v-show="hover" class="pt-0 mx-4">
            <v-col v-if="editable || label === 'keywords'">
              <editable-block
                :vals="vals"
                :label="label"
                :key="id"
              />
            </v-col>

            <template v-if="!editable && $root.islist(vals)">
              <v-btn
                depressed
                outlined
                color="#0c6efd"
                @click.stop="additem"
              >
                <v-icon> mdi-plus </v-icon> Add item
              </v-btn>
              <v-spacer />
              <v-btn
                depressed
                outlined
                color="#0c6efd"
                @click.stop="vals.pop()"
                :disabled="(vals.length === 1)"
              >
                <v-icon> mdi-minus </v-icon> Remove last item
              </v-btn>
            </template>

          </v-card-actions>

        </v-card>
      </v-hover>
    </template>

    </div>
</script>

<script type="text/javascript">
  Vue.component("GuiBlock", {
    name: "GuiBlock",
    template: "#gui-block",
    props: ["label", "vals", "depth"],
    data: function () {
      return {
        dialog: this.$root.dialog,
        id: this.$vnode.key,
        depth_: this.depth ? this.depth : 0,
      };
    },
    computed: {
      editable: function () {
        try {
          for (const [k, v] of Object.entries(this.vals)) {
            if (isNaN(k) || v === null) {
              return true;
            }
          }
        } catch (err) {
          return false;
        }
        return false;
      },
      renderable: function () {
        if (typeof this.vals !== "object" || this.vals === null) {
          return true;
        } else {
          return false;
        }
      },
    },
    methods: {
      additem: function () {
        if (this.vals.length === 0) {
          this.vals.push(null);
        } else if (this.id.includes("context")) {
          this.vals.push({ " ": null });
        } else {
          var item = this.$root.copy(this.vals).pop();
          for (const [key, value] of Object.entries(item)) {
            item[key] = null;
          }
          this.vals.push(item);
        }
      },
    },
  });
</script>